<!DOCTYPE html>
<html>
<head>
    <title>Frontend Fix Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
        input, textarea { width: 100%; margin: 5px 0; padding: 8px; }
        button { padding: 10px 20px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>SuperAdmin Dashboard Fix Test</h1>
    
    <div>
        <h3>Step 1: Enter JWT Token</h3>
        <p>Token from login: jamal1@gmail.com / 1234</p>
        <textarea id="token" rows="3">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwiZW1haWwiOiJqYW1hbDFAZ21haWwuY29tIiwicm9sZSI6IlNVUEVSQURNSU4iLCJpYXQiOjE3NjU5MDI0ODgsImV4cCI6MTc2ODQ5NDQ4OH0.kvnEIsYvkE0hW5OL43o_CtPNdI2zEnnZ6oaypfE_iyw</textarea>
    </div>
    
    <div>
        <h3>Step 2: Test Endpoints</h3>
        <button onclick="testAdminUsers()">Test /api/admin/users</button>
        <button onclick="testAuthUsers()">Test /api/auth/users</button>
        <button onclick="testWithWrongToken()">Test with Wrong Token</button>
        <button onclick="testWithoutToken()">Test without Token</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        const BASE_URL = 'http://localhost:5001';
        
        function addResult(message, className = '') {
            const resultsDiv = document.getElementById('results');
            const pre = document.createElement('pre');
            pre.className = className;
            pre.textContent = message;
            resultsDiv.appendChild(pre);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        async function testAdminUsers() {
            clearResults();
            const token = document.getElementById('token').value.trim();
            
            addResult(`Testing: GET ${BASE_URL}/api/admin/users`);
            addResult(`Using token: ${token.substring(0, 50)}...`);
            
            try {
                const response = await fetch(`${BASE_URL}/api/admin/users`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                addResult(`Status: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`✅ SUCCESS!`, 'success');
                    addResult(`Found ${data.count} users:`, 'success');
                    
                    data.data.forEach(user => {
                        addResult(`  - ${user.name} (${user.email}) - ${user.role}`);
                    });
                } else {
                    const error = await response.text();
                    addResult(`❌ ERROR: ${error}`, 'error');
                }
            } catch (error) {
                addResult(`❌ FETCH ERROR: ${error.message}`, 'error');
                
                if (error.message.includes('Failed to fetch')) {
                    addResult('⚠️ CORS issue detected! Check server CORS configuration.');
                }
            }
        }
        
        async function testAuthUsers() {
            clearResults();
            const token = document.getElementById('token').value.trim();
            
            addResult(`Testing: GET ${BASE_URL}/api/auth/users`);
            
            try {
                const response = await fetch(`${BASE_URL}/api/auth/users`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                addResult(`Status: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`✅ SUCCESS!`, 'success');
                    addResult(JSON.stringify(data, null, 2));
                } else {
                    const error = await response.text();
                    addResult(`❌ ERROR: ${error}`, 'error');
                }
            } catch (error) {
                addResult(`❌ FETCH ERROR: ${error.message}`, 'error');
            }
        }
        
        async function testWithWrongToken() {
            clearResults();
            addResult(`Testing with invalid token...`);
            
            try {
                const response = await fetch(`${BASE_URL}/api/admin/users`, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer wrong-token-here',
                        'Content-Type': 'application/json'
                    }
                });
                
                addResult(`Status: ${response.status} ${response.statusText}`);
                const error = await response.text();
                addResult(`Response: ${error}`);
            } catch (error) {
                addResult(`Error: ${error.message}`);
            }
        }
        
        async function testWithoutToken() {
            clearResults();
            addResult(`Testing without token (should fail)...`);
            
            try {
                const response = await fetch(`${BASE_URL}/api/admin/users`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                addResult(`Status: ${response.status} ${response.statusText}`);
                const data = await response.text();
                addResult(`Response: ${data}`);
            } catch (error) {
                addResult(`Error: ${error.message}`);
            }
        }
    </script>
</body>
</html>
